# 🎓 课程评分系统需求文档（v1.1）

## 1. 项目概述
**项目名称：** Course Rate（课程评分系统）  

**项目目标：** 为校内学生提供一个在线教师评分与反馈平台。学生可在校内登录系统，对所修课程任课教师进行匿名评分与文字评价，系统自动统计教师综合得分，供学生查询参考。  

> 💡 教师不登录系统，仅作为被评分对象存在。  

---

## 2. 系统范围与用户角色

| 角色 | 权限与职责 |
|------|-------------|
| **学生（唯一登录用户）** | 注册、登录、查看课程、提交评分与文字评价、查看教师综合评分 |
| **管理员（系统维护者）** | 导入/维护教师与课程数据、查看统计结果、导出报表 |
| **教师** | 仅作为被评分对象存在，不登录系统 |

**访问限制：**  
系统仅限 **校园网内访问**（通过 IP 段校验实现）。  
非校内网络访问将返回 403 禁止访问。

---

## 3. 系统功能需求

### 3.1 学生端功能
| 功能 | 描述 |
|------|------|
| 🔐 登录注册 | 使用邮箱+密码注册与登录，JWT 鉴权 |
| 📚 查看课程列表 | 登录后展示该学生的课程信息 |
| ⭐ 提交评分 | 对课程教师进行评分（1–5 分），含多维度指标 |
| 📝 文字反馈 | 可填写课程或教师的简短文字评价（选填） |
| 🔒 评分限制 | 每门课每学期仅能提交一次评价；不可重复修改 |
| 🕒 历史记录 | 查看自己已提交的评分与评论 |
| 📊 教师综合评分展示 | 在课程或教师页面显示该教师的综合得分（平均分 + 总评价数） |

---

### 3.2 管理端功能（非学生可见）
| 功能 | 描述 |
|------|------|
| 📦 数据维护 | 导入教师、课程、节次等基础数据（CSV 或后台录入） |
| 📈 统计分析 | 查看每位教师的平均分、评价数量与分布趋势 |
| 📤 报表导出 | 导出统计结果（CSV / Excel） |
| 🧩 权限控制 | 管理员独立账号，仅校方维护 |

---

## 4. 安全与访问控制

| 模块 | 安全策略 |
|------|-----------|
| **访问限制** | 仅允许校内 IP 段（如 10.x.x.x、172.16.x.x、192.168.x.x、202.120.x.x）访问 |
| **登录验证** | JWT Token（有效期 ≤ 7 天） |
| **密码安全** | bcrypt 加密存储 |
| **接口保护** | 所有 `/api/*` 接口需携带有效 JWT |
| **环境文件** | `.env` 中存放密钥与数据库 URL，公开仓库仅提交 `.env.example` |

---

## 5. 系统架构设计

| 层级 | 技术选型 |
|------|-----------|
| 前端 | Next.js 16（TypeScript + App Router + TailwindCSS） |
| 后端 | Next.js API Routes + Prisma |
| 数据库 | PostgreSQL（Neon 或校园自建数据库） |
| 鉴权 | JWT（JSON Web Token） |
| 部署 | 校园服务器 / WSL2 Ubuntu 环境 |
| 安全 | 校内 IP 白名单 + HTTPS（自签或校方 CA 证书） |

---

## 6. 数据库设计（核心模型）

| 表名 | 说明 |
|------|------|
| **Student** | 登录用户表（学生信息与认证） |
| **Teacher** | 教师基础信息（被评分对象） |
| **Course** | 课程信息（关联教师） |
| **Session** | 节次或学期（可选） |
| **Evaluation** | 评分记录表（学生→课程→教师） |

### 6.1 教师综合评分逻辑
综合评分 = 所有评分的平均值  
评价数 = 所有评分记录数量  

\[
\text{平均分} = \frac{\sum_{\text{所有评分}} \text{rating}}{\text{评分总数}}
\]

系统通过 `/api/teacher/[id]/rating` 接口实时计算并返回：
```json
{
  "teacherId": "t123",
  "avgRating": 4.9,
  "totalReviews": 1000
}
```

---

## 7. 评分项设计（维度说明）

| 指标 | 权重 | 描述 |
|------|-------|------|
| 教学态度 | 25% | 是否认真负责、尊重学生 |
| 内容清晰度 | 25% | 教学结构与表达是否清楚 |
| 互动与反馈 | 20% | 课堂互动与答疑质量 |
| 作业与考核 | 15% | 作业难度与考核合理性 |
| 学习收获 | 15% | 学生总体学习体验 |

> 学生评分采用 **1–5 分制**，系统根据这些维度计算综合平均分。

---

## 8. 非功能性需求

| 类别 | 要求 |
|------|------|
| 性能 | 支持 ≥ 1000 并发访问；平均响应时间 < 1s |
| 安全性 | HTTPS 全站加密；密码哈希；Token 过期检测 |
| 稳定性 | Prisma ORM 自动迁移，支持数据库备份 |
| 可维护性 | 模块化结构，命名规范一致；代码注释率 ≥ 20% |
| 可扩展性 | 可新增匿名统计、可视化图表模块 |
| 易用性 | UI 简洁清晰，适配移动端浏览 |

---

## 9. 部署与运行

| 环境 | 说明 |
|------|------|
| Node.js | ≥ v22.21.1（使用 nvm 管理） |
| npm | ≥ 10.9.4 |
| 系统 | Ubuntu（WSL2 / 校园服务器） |
| 数据库 | PostgreSQL |
| 命令 | `npm run dev` / `npm run build` / `npm start` |

---

## 10. 项目阶段计划

| 阶段 | 目标 | 内容 |
|------|------|------|
| **A1 Init** | 初始化项目 | Next.js + Prisma 环境可运行 |
| **A2 Auth** | 完成注册登录 | 学生 JWT 鉴权 |
| **A3 Eval** | 评分功能 | 课程评价接口与前端表单 |
| **A4 Stats** | 教师综合评分展示 | 平均分统计接口与前端展示 |
| **A5 Deploy** | 校内部署上线 | 校园服务器 + IP 限制配置 |

---

## 11. 风险与约束

- ⚠️ 校园网 IP 段配置需准确，否则会阻止合法访问。  
- ⚠️ `.env` 文件严禁推送到公共仓库。  
- ⚠️ 若未来添加教师端，需要调整权限体系与模型结构。  

---

## 12. 附录

### `.env.example`
```env
DATABASE_URL="postgresql://<user>:<password>@<host>:5432/<db>?schema=public"
JWT_SECRET="temp_placeholder"
ALLOWED_IP_PREFIXES="10.,172.16.,192.168.,202.120."
```

---

## 13. 后续扩展方向

- 🔹 增加数据可视化（ECharts / Chart.js）  
- 🔹 按学期 / 教师维度筛选与统计  
- 🔹 Excel 导出教师综合评分报表  
- 🔹 匿名标签分析（自然语言情感分析）  
- 🔹 自动生成教学质量报告  
